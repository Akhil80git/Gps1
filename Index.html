<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Location Selector with GPS</title>
  <style>
    body { font-family: Arial, sans-serif; background: #eef2ff; margin:0; padding:20px; }
    h2 { text-align:center; }
    .container { max-width:500px; margin:auto; background:#fff; padding:20px; border-radius:12px; box-shadow:0 4px 8px rgba(0,0,0,0.2); }
    .location-option { border:2px solid #ccc; padding:12px; margin:10px 0; border-radius:8px; cursor:pointer; }
    .location-option:hover { background:#f1f5f9; }
    .highlight { border-color:#4f46e5; background:#e0e7ff; }
    #gpsLoading { display:none; text-align:center; color:#2563eb; }
    #status { margin-top:15px; font-weight:bold; text-align:center; }

    /* ‚úÖ Popup style */
    #popup {
      display:none; position:fixed; top:0; left:0; width:100%; height:100%;
      background:rgba(0,0,0,0.5); display:flex; align-items:center; justify-content:center;
    }
    #popupContent {
      background:#fff; padding:20px; border-radius:12px; text-align:center; max-width:300px;
      box-shadow:0 4px 10px rgba(0,0,0,0.3);
    }
    #popup button {
      margin:10px; padding:10px 20px; border:none; border-radius:8px; cursor:pointer; font-weight:bold;
    }
    #allowBtn { background:#4f46e5; color:#fff; }
    #blockBtn { background:#dc2626; color:#fff; }
  </style>
</head>
<body>
  <div class="container">
    <h2>üìç Select Your Location</h2>

    <div id="gpsOption" class="location-option">
      <strong>üì° Use Current Location (GPS)</strong>
      <div id="gpsLoading">‚è≥ Getting GPS location...</div>
    </div>

    <div id="manualOption" class="location-option">
      <strong>üè† Sheetal Dham, Bhopal</strong><br>
      Latitude: 23.123276, Longitude: 77.495896
    </div>

    <div id="t2mnOption" class="location-option">
      <strong>üè¢ T2mn Location</strong><br>
      Latitude: 23.121101, Longitude: 77.494404
    </div>

    <div id="status"></div>
  </div>

  <!-- ‚úÖ Custom Popup -->
  <div id="popup">
    <div id="popupContent">
      <p>üîí This site wants to use your Location.</p>
      <button id="allowBtn">Allow</button>
      <button id="blockBtn">Block</button>
    </div>
  </div>

  <script>
    const gpsOption = document.getElementById('gpsOption');
    const manualOption = document.getElementById('manualOption');
    const t2mnOption = document.getElementById('t2mnOption');
    const gpsLoadingEl = document.getElementById('gpsLoading');
    const statusEl = document.getElementById('status');

    const popup = document.getElementById('popup');
    const allowBtn = document.getElementById('allowBtn');
    const blockBtn = document.getElementById('blockBtn');

    let bestCoords = null;
    let watchId = null;

    // Helper to highlight selected option
    function highlightOption(optionEl) {
      [gpsOption, manualOption, t2mnOption].forEach(el => el.classList.remove('highlight'));
      optionEl.classList.add('highlight');
    }

    // Manual options
    manualOption.addEventListener('click', () => {
      highlightOption(manualOption);
      statusEl.textContent = '‚úÖ Manual location selected: Sheetal Dham';
    });

    t2mnOption.addEventListener('click', () => {
      highlightOption(t2mnOption);
      statusEl.textContent = '‚úÖ Manual location selected: T2mn Location';
    });

    // GPS Option ‚Üí Show Popup first
    gpsOption.addEventListener('click', () => {
      popup.style.display = 'flex';
    });

    // ‚úÖ If Allow pressed ‚Üí Start GPS
    allowBtn.addEventListener('click', () => {
      popup.style.display = 'none';
      startGPS();
    });

    // ‚ùå If Block pressed ‚Üí Show message + manual option
    blockBtn.addEventListener('click', () => {
      popup.style.display = 'none';
      statusEl.textContent = '‚ùå You blocked GPS. Please select location manually.';
      highlightOption(manualOption);
    });

    // ‚úÖ Function to get GPS
    function startGPS() {
      gpsLoadingEl.style.display = 'block';
      statusEl.textContent = '‚è≥ Getting location...';

      if (navigator.geolocation) {
        watchId = navigator.geolocation.watchPosition(
          pos => {
            const { latitude, longitude, accuracy } = pos.coords;
            if (!bestCoords || accuracy < bestCoords.accuracy) {
              bestCoords = { latitude, longitude, accuracy };
              highlightOption(gpsOption);
              statusEl.textContent = `‚úÖ GPS Location: Lat ${latitude.toFixed(6)}, Lng ${longitude.toFixed(6)}, Accuracy: ${accuracy.toFixed(1)}m`;
            }
          },
          err => {
            statusEl.textContent = '‚ùå GPS error: ' + err.message;
            gpsLoadingEl.style.display = 'none';
            highlightOption(manualOption);
          },
          { enableHighAccuracy: true, timeout: 60000, maximumAge: 0 }
        );

        // Stop after 60 sec
        setTimeout(() => {
          if (watchId !== null) {
            navigator.geolocation.clearWatch(watchId);
            watchId = null;
            gpsLoadingEl.style.display = 'none';
            if (bestCoords) {
              statusEl.textContent = '‚úÖ GPS location finalized.';
            } else {
              statusEl.textContent = '‚ùå GPS data not received. Select manually.';
              highlightOption(manualOption);
            }
          }
        }, 60000);
      } else {
        statusEl.textContent = '‚ùå Geolocation not supported';
        gpsLoadingEl.style.display = 'none';
        highlightOption(manualOption);
      }
    }
  </script>
</body>
</html>
